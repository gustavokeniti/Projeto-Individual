<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./assets/imgs/logo.png" type="image/x-icon">
    <title>Dashboard</title>
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
</head>

<body>
    <div class="container">
        <div class="side-bar">
            <div class="titulo">
                <h1>BasketMetrics</h1>
            </div>
            <a href="dashboard-geral.html">Geral</a>
            <a href="escolha-posicao.html">Voltar</a>
            <a href="index.html">Log out</a>
        </div>
        <div class="graficos">
            <h1>Posição - Alas</h1>
            <div class="kpiData">Última Atualização: <span id="dataHora"></span></div>
            <!-- O gráfico será inserido aqui dinamicamente -->
        </div>
    </div>
</body>

</html>

<script>
    function atualizarDataHora() {
        const agora = new Date();
        const dataHoraFormatada = agora.toLocaleString("pt-BR"); // horario e data brasileiros
        document.getElementById("dataHora").textContent = dataHoraFormatada;
    }

    // Atualiza a hora quanto recarrega a pagina
    atualizarDataHora();

    // Fetch para pegar os dados do servidor
    fetch("/dashboard/Alas")
        .then(res => res.json())
        .then(data => {
            // Para cada jogador no vetor de dados
            data.forEach((jogador, index) => {

                console.log(jogador)
                // Cria um container para o gráfico do jogador
                const container = document.createElement('div');
                container.classList.add('first-grafico');
                
                // Cria um canvas para o gráfico
                const canvas = document.createElement('canvas');
                canvas.id = `barra-${index}`;
                container.appendChild(canvas);

                // Adiciona o gráfico ao HTML, dentro da div "graficos"
                document.querySelector('.graficos').appendChild(container);

                const graficoBarra = document.getElementById(`barra-${index}`);

                const labels = ['Arremesso', 'Passe', 'Drible', 'Controle', 'Defesa', 'Média Geral'];
                const valores = [
                    jogador.arremesso,
                    jogador.passe,
                    jogador.drible,
                    jogador.controle,
                    jogador.defesa,
                    jogador.Mediageral
                ];

                // Cria o gráfico usando Chart.js
                new Chart(graficoBarra, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `Habilidades`,  // Nome do jogador no título
                            data: valores,
                            borderColor: "black",
                            backgroundColor: ['#3b0764', '#581c87', '#6b21a8', '#a855f7', '#9333ea', '#845ca8'],
                            borderWidth: 1,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Nível',
                                    font: {
                                        size: 20
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Skills',
                                    font: {
                                        size: 20
                                    }
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: `Nome - ${jogador.nome} | Idade - ${jogador.idade} | Altura - ${jogador.altura} | Telefone: ${jogador.telefone}`,
                                font: {
                                    size: 25
                                }
                            },
                        },
                    },
                });
            });
        });
</script>
